# Step 1: Import Libraries
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# Step 2: Load the Dataset
df = pd.read_csv("heart_disease_uci.csv")

# Step 3: Basic Info
print("Initial Shape:", df.shape)
print("Missing values:\n", df.isnull().sum())

# Step 4: Convert categorical columns
categorical_cols = ['sex', 'cp', 'fbs', 'restecg', 'exang', 'slope', 'thal']
for col in categorical_cols:
    df[col] = df[col].astype('category')

# Step 5: Drop columns with >50% missing values
df.drop(columns=['ca', 'thal'], inplace=True)

# Step 6: Drop rows with remaining missing values
df.dropna(inplace=True)
print("Cleaned Shape:", df.shape)

# Step 7: Univariate Visualizations
plt.figure(figsize=(18, 12))

plt.subplot(2, 3, 1)
sns.histplot(df['age'], bins=15, kde=True, color='skyblue')
plt.title("Age Distribution")

plt.subplot(2, 3, 2)
sns.histplot(df['chol'], bins=15, kde=True, color='salmon')
plt.title("Cholesterol Distribution")

plt.subplot(2, 3, 3)
sns.histplot(df['trestbps'], bins=15, kde=True, color='orange')
plt.title("Resting Blood Pressure Distribution")

plt.subplot(2, 3, 4)
sns.countplot(x='sex', data=df, palette='Set2')
plt.title("Sex Distribution")

plt.subplot(2, 3, 5)
sns.countplot(x='cp', data=df, palette='Set3')
plt.title("Chest Pain Type Distribution")
plt.xticks(rotation=15)

plt.subplot(2, 3, 6)
sns.histplot(df['thalch'], bins=15, kde=True, color='purple')
plt.title("Max Heart Rate (thalch) Distribution")

plt.tight_layout()
plt.show()

# Step 8: Bivariate Analysis â€“ Heart Disease vs Other Features
# Convert target to binary (0 = no disease, 1+ = disease)
df['target'] = df['num'].apply(lambda x: 1 if x > 0 else 0)

plt.figure(figsize=(16, 10))

plt.subplot(2, 2, 1)
sns.boxplot(x='target', y='age', data=df)
plt.title("Age vs Heart Disease")

plt.subplot(2, 2, 2)
sns.boxplot(x='target', y='chol', data=df)
plt.title("Cholesterol vs Heart Disease")

plt.subplot(2, 2, 3)
sns.countplot(x='sex', hue='target', data=df)
plt.title("Heart Disease by Sex")

plt.subplot(2, 2, 4)
sns.countplot(x='cp', hue='target', data=df)
plt.title("Heart Disease by Chest Pain Type")
plt.xticks(rotation=15)

plt.tight_layout()
plt.show()

# Step 9: Correlation Heatmap
numeric_df = df.select_dtypes(include=['float64', 'int64'])
plt.figure(figsize=(10, 8))
sns.heatmap(numeric_df.corr(), annot=True, cmap='coolwarm', fmt=".2f")
plt.title("Correlation Heatmap")
plt.show()
